{% extends 'base.html' %}

{% block title %}
Clientes
{% endblock %}

{% block css %}{% endblock %}

{% block conteudo %}

<div class="container-fluid">
    <h2 class="p-10">Clientes</h2>
    <div class="text-right">
        <button class="btn btn-primary cadastrar-button m-3" onclick="exibirFormularioCadastro()">Cadastrar Cliente</button>
    </div>

    <div class="card" style="background-color: #eee;">

        <form id="formularioCadastro" style="display: none;">
            <div class="form-group">
                <label for="nome">Nome:</label>
                <input type="text" class="form-control" id="nome" required>
            </div>
            <div class="form-group">
                <label for="tipo">Tipo:</label>
                <select class="form-control tipo" id="tipo">
                    <option value="PF">Pessoa Física</option>
                    <option value="PJ">Pessoa Jurídica</option>
                </select>
            </div>
            <div class="form-group">
                <label for="documento">Documento:</label>
                <input type="text" class="form-control" id="documento" required>
            </div>
            <div class="form-group">
                <label for="endereco">Endereço:</label>
                <input type="text" class="form-control" id="endereco" required>
            </div>
            <div class="form-group">
                <label for="telefone">Telefone:</label>
                <input type="text" class="form-control" id="telefone" required>
            </div>
            <div class="form-group">
                <label for="dataNascimento">Data de Nascimento:</label>
                <input type="date" class="form-control" id="dataNascimento" required>
            </div>
            <button type="button" class="btn btn-success" onclick="cadastrarCliente()">Salvar</button>
        </form>

        <div class="table-responsive">
            <table id="zero_config" class="table table-striped table-bordered">
                <thead>
                    <tr>
                        <th>Nome</th>
                        <th>Tipo</th>
                        <th>Documento</th>
                        <th>Endereço</th>
                        <th>Telefone</th>
                        <th>Data de Nascimento</th>
                        <th>Ações</th>
                    </tr>
                </thead>
                <tbody id="tabela-clientes">
                </tbody>
            </table>
        </div>
    </div>
</div>

{% endblock %}

{% block js %}
<script>
    let listaDeClientes = [];
    let clienteEmEdicaoId = null;

    function exibirFormularioCadastro() {
        document.getElementById("formularioCadastro").style.display = "block";
    }

    function cadastrarCliente() {
    const nome = document.getElementById("nome").value;
    const tipo = document.getElementById("tipo").value;
    const documento = document.getElementById("documento").value;
    const endereco = document.getElementById("endereco").value;
    const telefone = document.getElementById("telefone").value;
    const dataNascimento = document.getElementById("dataNascimento").value;

    if (clienteEmEdicaoId !== null) {
        // Atualiza um cliente existente
        const clienteIndex = listaDeClientes.findIndex(c => c.id === clienteEmEdicaoId);
        listaDeClientes[clienteIndex] = {
            id: clienteEmEdicaoId,
            nome,
            tipo,
            documento,
            endereco,
            telefone,
            dataNascimento
        };
    } else {
        // Adiciona um novo cliente
        const novoCliente = {
            id: new Date().getTime(),
            nome,
            tipo,
            documento,
            endereco,
            telefone,
            dataNascimento
        };
        listaDeClientes.push(novoCliente);
    }

    atualizarTabelaClientes();

    clienteEmEdicaoId = null;

    limparFormularioCadastro();
}

    function abrirFormularioEdicao(clienteId) {
        clienteEmEdicaoId = clienteId;
        const cliente = listaDeClientes.find(c => c.id === clienteId);

        document.getElementById("nome").value = cliente.nome;
        document.getElementById("tipo").value = cliente.tipo;
        document.getElementById("documento").value = cliente.documento;
        document.getElementById("endereco").value = cliente.endereco;
        document.getElementById("telefone").value = cliente.telefone;
        document.getElementById("dataNascimento").value = cliente.dataNascimento;

        exibirFormularioCadastro();
    }

    function salvarEdicao() {
        if (clienteEmEdicaoId !== null) {
            const index = listaDeClientes.findIndex(c => c.id === clienteEmEdicaoId);

            listaDeClientes[index].nome = document.getElementById("nome").value;
            listaDeClientes[index].tipo = document.getElementById("tipo").value;
            listaDeClientes[index].documento = document.getElementById("documento").value;
            listaDeClientes[index].endereco = document.getElementById("endereco").value;
            listaDeClientes[index].telefone = document.getElementById("telefone").value;
            listaDeClientes[index].dataNascimento = document.getElementById("dataNascimento").value;

            limparFormularioCadastro();
            atualizarTabelaClientes();
        } else {
            console.error("Nenhum cliente em edição encontrado.");
        }
    }

    function deletarCliente(clienteId) {
        const confirmacao = confirm("Tem certeza que deseja deletar este cliente?");
        if (confirmacao) {
            listaDeClientes = listaDeClientes.filter(c => c.id !== clienteId);
            atualizarTabelaClientes();
        }
    }

    function limparFormularioCadastro() {
        document.getElementById("nome").value = "";
        document.getElementById("tipo").value = "";
        document.getElementById("documento").value = "";
        document.getElementById("endereco").value = "";
        document.getElementById("telefone").value = "";
        document.getElementById("dataNascimento").value = "";

        document.getElementById("formularioCadastro").style.display = "none";

        clienteEmEdicaoId = null;
    }

    function atualizarTabelaClientes() {
    const tabelaClientes = document.getElementById("tabela-clientes");
    tabelaClientes.innerHTML = "";

    if (listaDeClientes.length === 0) {
        const row = tabelaClientes.insertRow();
        const cell = row.insertCell(0);
        cell.colSpan = 8;
        cell.innerHTML = "Nenhum cliente";
    } else {
        listaDeClientes.forEach(cliente => {
            const row = tabelaClientes.insertRow();
            row.innerHTML = `
                <td>${cliente.nome}</td>
                <td>${cliente.tipo}</td>
                <td>${cliente.documento}</td>
                <td>${cliente.endereco}</td>
                <td>${cliente.telefone}</td>
                <td>${cliente.dataNascimento}</td>
                <td class="text-center">
                    <button class="btn btn-info mx-2" onclick="abrirFormularioEdicao(${cliente.id})"><i class="fas fa-edit"></i></button>
                    <button class="btn btn-danger mx-2" onclick="deletarCliente(${cliente.id})"><i class="far fa-times-circle"></i></button>
                </td>
            `;
        });
    }
}

    window.onload = function () {
        atualizarTabelaClientes();
    }
</script>
{% endblock %}
